#!/usr/bin/env bash
# commit-msg hook to require JIRA ticket in commit message for patch-related commits

MSG_FILE="$1"
MSG="$(cat "$MSG_FILE")"

# If commit message references patches/ or patch file changes, enforce JIRA key
if git diff --name-only --cached | grep -E '^patches/' >/dev/null 2>&1; then
  if ! echo "$MSG" | grep -E -i '([A-Za-z][A-Za-z0-9]+-[0-9]+)' >/dev/null; then
    echo "ERROR: Commits that touch patches/* must reference a JIRA ticket (e.g., OPS-123) in the commit message."
    exit 1
  fi
fi

exit 0
